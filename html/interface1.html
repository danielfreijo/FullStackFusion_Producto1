<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home</title>
    <link href="../assets/libraries/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="../css/style.css">
</head>

<body>
    <div class="container-fluid">


        
    <!--Men√∫ de navegaci√≥n-->
    <nav class="navbar navbar-expand-md navbar-dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="index.html">
                <img src="../assets/logo.png" alt="Logo" width="125" height="70" class="d-inline-block">
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>                
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="interface1.html">INICIO</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">PROYECTOS</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">PROYECTOS<br>PRIORITARIOS</a>
                    </li>
                    <li class="nav-item">
                        <label class="nav-link" id ="lbluser" name="lbluser">Did you know?</label>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link boton" name="addproject" id="addproject" href="#">A√ëADIR PROYECTO</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    <br>
    <div class="container-fluid">
        <h3>Proyectos recientes
        <a class="btn" href="#" name="refresh1" id="refresh1">‚Ü∫</a></h3>
        <div class="ProjectsBar" name="RecentProjects" id="RecentProjects">
            <!-- Se muestra al abrir la pagina -->    
        </div>
<br><br>
        <!-- Panel de Proyectos -->
        <h3>Proyectos
        <a  class="btn"  href="#" name="refresh2" id="refresh2">‚Ü∫</a></h3>
        <div class="ProjectsBar" name="AllProjects" id="AllProjects">
            <!-- Se muestra al abrir la pagina -->  
    </div>
    

<!-- Modal -->
<div class="modal fade" id="ModalForm" tabindex="-1" role="dialog" aria-labelledby="TitleModal" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="TitleModal">T√≠tulo del Modal</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body" id="formulario" name="formulario">
          Contenido del modal...
        </div>
  <!--
          <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
          <button type="button" class="btn btn-primary">Guardar cambios</button>
        </div>
    --> 
      </div>
    </div>
  </div>

</div>
    <!--Scripts para funcionalidades-->
    <script src="../assets/libraries/jquery-3.6.0.min.js" ></script>
    <script src="../assets/libraries/popper.min.js" ></script>
    <script src="../assets/libraries/bootstrap.bundle.min.js"></script>
    <script src="../js/data.js"></script>
    <script src="../js/index.js"></script>
    <script>
    $(document).ready(function() {
        // Mostrar el valor de la cookie en el elemento con el id "username"
        var v_username = "Bienvenido " + sessionStorage.getItem("username");
        $("#lbluser").text(v_username);

        allProjects();
        recentProjects();

        function recentProjects(){
            $('#RecentProjects').html("");
            var v_startdate = new Date();
            v_startdate.setHours(0,0,0,0); // Establece la hora a medianoche
            $.each(projects, function(index, data) {
                var v_enddate = new Date(data.startdate);  // Establecemos la fecha de incio del proyecto
                var diff = Math.abs(v_startdate-v_enddate); // Diferencia de dias entre la fecha actual y la fecha de inicio del proyecto
                var diff_days=diff/(1000*60*60*24); // Lo pasamos a dias
                // Si es un proyecto de hace 30 dias o menos lo mostramos como reciente
                if (diff_days<=30){
                    // A√±adimos la tarjeta del proyecto a la vista de recientes
                    $('#RecentProjects').append(defineCard(index));
                }
            });
        };

        function allProjects(){
            $('#AllProjects').html("");
            $.each(projects, function(index, data) {
                // A√±adimos el Proyecto a la vista de todos.
                $('#AllProjects').append(defineCard(index));
            });
        };

        function defineCard(index){
            var text='<div class="card" style="width: 18rem;">';
             text +='<img class="card-img-top" src="../assets/' + projects[index]["backgroundimage"] + '" alt="Card image cap">';  
             text +='<div class="card-img-overlay">';
             text +='<h5 class="card-title">'+ projects[index]["name"];
             if (projects[index]["status"]!=1){
                // Si un proyecto esta completado no se puede eliminar.
                text +='<a href="#" class="btn close-button deteleproject" data="'+ projects[index]["id"]+'">‚ùå</a>'; 
             };
             text +='</h5>';
             text +='<p class="card-text" style="width:100px;overflow-wrap: break-word;">';
             text +=projects[index]["description"];
             text +='</p>';
             text +='</div>';
             text +='<div class="card-footer">';
             if (projects[index]["priority"]==0){
                text +='<a href="#" class="btn priority" style="position:absolute;left:3px" data="'+ projects[index]["id"]+'">‚òÖ</a>';
             }else{
                text +='<a href="#" class="btn downgrade" style="position:absolute;left:3px" data="'+ projects[index]["id"]+'">‚≠ê</a>';
             };
             text +='<a href="#" class="btn editproject" style="position:relative;left:100px" data="'+ projects[index]["id"]+'">üìù</a>';
             text +='<a href="#" class="btn openproject" style="position:absolute;right:3px"  data="'+ projects[index]["id"]+'">‚û†</a>';
             text +='</div>';
             text +='</div>';
             return text;
        };

        $('#refresh1').on("click", function(e){
            allProjects();
            recentProjects();
        });
        
        $('#refresh2').on("click", function(e){
            allProjects();
            recentProjects();
        });

        $('#addproject').on("click", function(e){
            e.preventDefault();
            // Cambio el titulo
            $("#TitleModal").text("NUEVO PROYECTO");
            // Cargo la plantilla
            $("#formulario").load("project.html");
            // Abro el formulario modal
            $("#ModalForm").modal('show');
            // Actualizo las listas de Proyectos
            allProjects();
            recentProjects();
            $("#ModalForm").modal('hide');
            e.stopPropagation();
        });


        // Cierra el modal al hacer clic en la "X"
        $(".close").click(function() {
            $("#ModalForm").modal('hide');
        });

    });    
    </script>

</body>
</html>